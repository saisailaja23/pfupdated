$.fn.extend({get_jquery_selector:function(a){var a=a?$(a)[0]:$()[0],b=this[0];if(b)for(var c="";b&&b.parentNode&&b!=a;){if(9==b.nodeType)return;c=">"+b.tagName.toLowerCase()+":eq("+$(b).prevAll(b.tagName).size()+")"+c;b=b.parentNode}return c.substring(1)}});
var YNTAE={hAS:function(a){$(".yn_t_ad_tour_station_edit_preview").stop().fadeTo(a,0)},showStation:function(a,b){$("#yn_t_ad_edit_station_"+a).stop().fadeTo(b,1)},gPSTT:function(a,b,c){var a=a.outerHeight(),c=c.outerHeight(!0),e=-1!=jQuery.inArray(b,"tl,tc,tr,bl,bc,br".split(","))?12:24;switch(b){case "tl":case "tc":case "tr":return-40;case "bl":case "bc":case "br":return 0-(a+e)-40;case "lt":case "rt":return-40;case "lc":case "rc":return a<c?0-c/2-40:0-a/2-40;case "lb":case "rb":return a>c?0-(a-
c)-40:-40}},sZA:function(a){"body"!=$(a)[0].tagName.toLowerCase()&&($(a).addClass("yn_tour_z_index_auto"),YNTAE.sZA(a.parent()))},aSL:function(a){YNTAE.sZA(a.parent());a.addClass("yn_tour_spot")},cSL:function(){$(".yn_tour_z_index_auto").removeClass("yn_tour_z_index_auto");$(".yn_tour_spot").removeClass("yn_tour_spot")},newStation:function(a,b){var c=$('<div class="yn_t_ad_tour_station_edit_preview" id="yn_t_ad_edit_station_'+a+'"><span class="yn_tour_arrow"></span><div><div class="yn_tour_text">'+
b+'</div><div class="yn_tour_ctrl"><span class="yn_tour_order">X/X</span><span class="yn_tour_controls ctrls"><a href="javascript:void(0)" class="yn_bt_prev"></a><a href="javascript:void(0)" class="yn_bt_next"></a></span></div></div></div>');c.fadeTo(0,0);return c},gPTL:function(a,b,c){var e=a.outerWidth(),h=a.outerHeight(),f=c.outerWidth(!0),g=c.outerHeight(!0),i=-1!=jQuery.inArray(b,"tl,tc,tr,bl,bc,br".split(","))?24:11,j=-1!=jQuery.inArray(b,"tl,tc,tr,bl,bc,br".split(","))?12:24,d;switch(b){case "tl":d=
{left:-11,top:0-g-j+3,arrow_left:1,arrow_top:0+g-1};break;case "tc":d={left:0-(f-e)/2,top:0-g-j+3,arrow_left:(f-i)/2,arrow_top:0+g-1};break;case "tr":d={left:0+e-f+11,top:0-g-j+3,arrow_left:0+f-i-1,arrow_top:0+g-1};break;case "bl":d={left:-11,top:0+j+h-3,arrow_left:1,arrow_top:0-j+4};break;case "bc":d={left:0-(f-e)/2,top:0+j+h-3,arrow_left:(f-i)/2,arrow_top:0-j+4};break;case "br":d={left:0+e-f+11,top:0+j+h-3,arrow_left:0+f-i-1,arrow_top:0-j+4};break;case "lt":d={left:0-f-i+3,top:-12,arrow_left:0+
f-2,arrow_top:-1};break;case "lc":d={left:0-f-i+3,top:0+(h-g)/2,arrow_left:0+f-2,arrow_top:0+(g-j)/2};break;case "lb":d={left:0-f-i+3,top:0+h-g+11,arrow_left:0+f-2,arrow_top:0+g-j-3};break;case "rt":d={left:0+e+i-2,top:-12,arrow_left:0-i+2,arrow_top:-1};break;case "rc":d={left:0+e+i-2,top:0+(h-g)/2,arrow_left:0-i+2,arrow_top:0+(g-j)/2};break;case "rb":d={left:0+e+i-2,top:0+h-g+10,arrow_left:0-i+2,arrow_top:0+g-j-3}}d.top=Math.max(5,0+a.offset().top+d.top);d.left=Math.max(5,0+a.offset().left+d.left);
c.css("top","string"===typeof d.top?d.top:d.top+"px").css("left","string"===typeof d.left?d.left:d.left+"px").attr("class","yn_t_ad_tour_station_edit_preview "+b);c.find(".yn_tour_arrow").css("top","string"===typeof d.arrow_top?d.arrow_top:d.arrow_top+"px").css("left","string"===typeof d.arrow_left?d.arrow_left:d.arrow_left+"px");return d},initTour:function(a,b,c){$(".yn_t_ad_tour_station_edit_preview").remove();YNTAE.cSL();$("#yn_t_ad_tour_"+b).after($(c));$("#yn_tour_bt_done_edit_tour").click(function(){$(".yn_t_ad_unit_station_edit.editing").length?
alert("Please finish editing station before finish the tour"):YnTourAdminJs.finishEditTour(b)});$(".yn_t_ad_unit_station_title").tooltip({track:!0,extraClass:"classic yn_tooltip",id:"yn_tooltip"});$(".yn_t_ad_img_unit_station_delete").tooltip({track:!0,extraClass:"critical yn_tooltip",id:"yn_tooltip",showURL:!1});$.each(a,function(a,b){YNTAE.initStation(b)});$("#yn_tour_bt_add_station").click(function(){YNTAE.beginFindSelector(b)});$("#yn_t_ad_block_station").sortable({handle:".yn_t_ad_img_unit_station_move",
update:function(){$.ajax({type:"POST",url:site_url+"modules/?r=tour_guide/ajax_mode/order_station_edit",data:$("#yn_t_ad_block_station").sortable("serialize")})}})},initStation:function(a){var b=YNTAE.newStation(a.id,a.msg);$("body").append(b);YNTAE.gPTL($(a.sel),a.position,b);$("#yn_t_ad_station_"+a.id+" img.yn_t_ad_img_unit_station_edit").click(function(){$("#yn_t_ad_station_"+a.id).hasClass("editing")?YNTAE.stopEditStation(a.id,a.sel,b):(YNTAE.goToStationEdit(a.id,a.sel,a.position),YNTAE.startEditStation(a.id))});
$("#yn_t_ad_station_"+a.id+" img.yn_t_ad_img_unit_station_reset").click(function(){YNTAE.resetStation(a.id,$(a.sel),a.position,b,a.msg)});$("#yn_t_ad_station_"+a.id+" img.yn_t_ad_img_unit_station_delete").click(function(){YNTAE.cDS(a.id)});$("input#yn_t_ad_unit_station_edit_msg_"+a.id).bind("keyup change",{station_id:a.id,sel:$(a.sel),station:b},YNTAE.kLME);$("select#yn_t_ad_unit_station_edit_pos_"+a.id).change(function(){YNTAE.ePS(a.id,$(a.sel),$(this).val(),b)})},selector:"div,a,input,select,img:not(#indexPhoto img,img.sys-online-offline,#yn_t_ad_mana_tour div,a,span,td,input,select,img)",
beginFindSelector:function(a){$("#yn_t_ad_mana_tour, #yn_t_ad_button_begin, #yn_tour_button_begin, .yn_tour_overlay, .yn_tour_overlay_white").hide();$(".yn_t_ad_tour_station_edit_preview").fadeTo(0,0);$(YNTAE.selector).bind("mouseover.active",function(a){$(a.currentTarget).hasClass("yn_t_ad_mouse_active")||$(a.currentTarget).addClass("yn_t_ad_mouse_active")}).bind("mouseout.active",function(a){$(a.currentTarget).hasClass("yn_t_ad_mouse_active")&&$(a.currentTarget).removeClass("yn_t_ad_mouse_active")}).bind("mousedown.active",
{tour_id:a},YNTAE.addStation)},addStation:function(a){$(".yn_tour_overlay, .yn_tour_overlay_white, #yn_t_ad_button_begin, #yn_tour_button_begin").show();$(".yn_t_ad_mouse_active").removeClass("yn_t_ad_mouse_active");$(YNTAE.selector).unbind(".active");$.ajax({type:"POST",url:site_url+"modules/?r=tour_guide/ajax_mode/add_station",dataType:"json",data:"tour_id="+a.data.tour_id+"&sel="+$(a.currentTarget).get_jquery_selector(),success:function(a){1==a.err?alert(a.msg_err):($("#yn_t_ad_block_station").append(a.new_station),
YNTAE.initStation(a.value),$("#yn_t_ad_mana_tour").show(),$("#yn_t_ad_station_"+a.value.id+" img.yn_t_ad_img_unit_station_edit").trigger("click"),$("#yn_t_ad_block_station").animate({scrollTop:$("#yn_t_ad_block_station").attr("scrollHeight")},1E3),$("#yn_t_ad_unit_station_edit_msg_"+a.value.id).select())}})},cDS:function(a){$("#yn_t_ad_station_"+a+" img.yn_t_ad_img_unit_station_delete").unbind().attr("src",site_url+"modules/younet/tour_guide/templates/base/images/station_delete_confirm.png").attr("title",
"Click again to delete this station").click(function(){YNTAE.deleteStation(a)}).tooltip({track:!0,extraClass:"critical yn_tooltip",id:"yn_tooltip",showURL:!1});$("#yn_tooltip").addClass("critical yn_tooltip").show().find("p").html("Click again to delete this station")},deleteStation:function(a){$.ajax({type:"POST",url:site_url+"modules/?r=tour_guide/ajax_mode/delete_station",dataType:"json",data:"station_id="+a,success:function(b){1==b.err?alert(b.msg_err):$("#yn_t_ad_station_"+a+", #yn_t_ad_edit_station_"+
a).slideUp(400,function(){$(this).remove();YNTAE.cSL()})}})},resetStation:function(a,b,c,e,h){$("#yn_t_ad_edit_station_"+a+" div.yn_tour_text").html(h);YNTAE.gPTL($(b),c,e);$("input#yn_t_ad_unit_station_edit_msg_"+a).val(h);$("select#yn_t_ad_unit_station_edit_pos_"+a).val(c);YNTAE.bES=!1},ePS:function(a,b,c,e){YNTAE.gPTL(b,c,e);YNTAE.bES=!0},oYnTimer:0,isRunning:0,bES:!1,kLME:function(a){YNTAE.oYnTimer&&(window.clearTimeout(YNTAE.oYnTimer),YNTAE.oYnTimer=0);YNTAE.oYnTimer=window.setTimeout(function(){YNTAE.kMESR(a)},
YNTAE.isRunning?2E3:200)},kMESR:function(a){YNTAE.isRunning?YNTAE.kLME():(YNTAE.isRunning=1,$("#yn_t_ad_edit_station_"+a.data.station_id+" div.yn_tour_text").html($(a.target).val()),YNTAE.gPTL(a.data.sel,$("select#yn_t_ad_unit_station_edit_pos_"+a.data.station_id).val(),a.data.station),YNTAE.isRunning=0,YNTAE.oYnTimer=0,YNTAE.bES=!0)},stopEditStation:function(a,b,c){var e=$("#yn_t_ad_unit_station_edit_msg_"+a).val(),h=$("#yn_t_ad_unit_station_edit_pos_"+a).val();$("#yn_t_ad_station_"+a+" img.yn_t_ad_img_unit_station_delete").click(function(){YNTAE.cDS(a)});
$.ajax({type:"POST",url:site_url+"modules/?r=tour_guide/ajax_mode/edit_station",dataType:"json",data:"station_id="+a+"&new_message="+e+"&new_position="+h,success:function(f){1==f.err?alert(f.msg_err):($("#yn_t_ad_station_"+a+" div.yn_t_ad_unit_station_title").attr("title",e).html(e).tooltip({track:!0,extraClass:"classic yn_tooltip",id:"yn_tooltip"}),$("#yn_t_ad_station_"+a+" img.yn_t_ad_img_unit_station_reset").unbind().click(function(){YNTAE.resetStation(a,$(b),h,c,e)}))}});YNTAE.cSL();YNTAE.hAS();
$("#yn_t_ad_station_"+a).removeClass("editing");$("#yn_t_ad_station_"+a+" img.yn_t_ad_img_unit_station_edit").attr("src",site_url+"modules/younet/tour_guide/templates/base/images/station_edit.png");$("#yn_t_ad_station_"+a).find("img.yn_t_ad_img_unit_station_reset,img.yn_t_ad_img_unit_station_delete").hide();$("#yn_t_ad_station_"+a+" div.yn_t_ad_unit_station_edit_form").slideUp();$("#yn_t_ad_station_"+a+" img.yn_t_ad_img_unit_station_delete").unbind().attr("src",site_url+"modules/younet/tour_guide/templates/base/images/station_delete.png").attr("title",
"Click 2 times to delete").click(function(){YNTAE.cDS(a)}).tooltip({track:!0,extraClass:"critical yn_tooltip",id:"yn_tooltip",showURL:!1})},startEditStation:function(a){YNTAE.cSL();YNTAE.hAS();$(".yn_t_ad_unit_station_edit_form:not(#yn_t_ad_station_"+a+" .yn_t_ad_unit_station_edit_form)").slideUp();$(".yn_t_ad_unit_station_edit.editing img.yn_t_ad_img_unit_station_edit").attr("src",site_url+"modules/younet/tour_guide/templates/base/images/"+(!0==YNTAE.bES?"station_not_save.png":"station_edit.png"));
YNTAE.bES=$("#yn_t_ad_station_"+a+" img.yn_t_ad_img_unit_station_edit").attr("src")==site_url+"modules/younet/tour_guide/templates/base/images/station_not_save.png"?!0:!1;$(".yn_t_ad_unit_station_edit.editing img.yn_t_ad_img_unit_station_delete").unbind().attr("src",site_url+"modules/younet/tour_guide/templates/base/images/station_delete.png").attr("title","Click 2 times to delete").click(function(){YNTAE.cDS($(".yn_t_ad_unit_station_edit.editing").attr("id").replace("yn_t_ad_station_",""))}).tooltip({track:!0,
extraClass:"critical yn_tooltip",id:"yn_tooltip",showURL:!1});$(".yn_t_ad_unit_station_edit.editing").removeClass("editing").find("img.yn_t_ad_img_unit_station_reset,img.yn_t_ad_img_unit_station_delete").hide();$("#yn_t_ad_station_"+a).addClass("editing");$("#yn_t_ad_station_"+a).find("img.yn_t_ad_img_unit_station_reset,img.yn_t_ad_img_unit_station_delete").show();$("#yn_t_ad_station_"+a+" img.yn_t_ad_img_unit_station_edit").attr("src",site_url+"modules/younet/tour_guide/templates/base/images/station_edit_done.png");
$("#yn_t_ad_station_"+a+" div.yn_t_ad_unit_station_edit_form").slideDown()},goToStationEdit:function(a,b,c){var e=$("#yn_t_ad_edit_station_"+a),b=$(b);$.scrollTo(e,{duration:500,offset:{left:0,top:YNTAE.gPSTT(b,c,e)},onAfter:function(){YNTAE.showStation(a,500);YNTAE.aSL(b)}})}};
YnTourAdminJs={bMouseActive:!0,bActive:!1,bFirstRun:!0,init:function(){YnTourAdminJs.bActive=!1;$.ajax({type:"POST",url:site_url+"modules/?r=tour_guide/ajax_mode/get_form_station_admin",dataType:"json",data:"pathname="+window.location.hostname+window.location.pathname,success:function(a){a.form_admin_manage&&($("body").append(a.form_admin_manage),$("img#yn_t_ad_bt_done").click(function(){$(".yn_t_ad_unit_station_edit.editing").length?alert("Please finish editing station first"):YnTourAdminJs.closePopupManageTour()}),
YnTourAdminJs.initFormManageTour(a.tour_ids))}})},initFormManageTour:function(){$("input#yn_tour_bt_add_tour").click(function(){YnTourAdminJs.showFormAddNewTour()});$("input#yn_t_ad_f_add_button").click(function(){YnTourAdminJs.addNewTour()});YnTourAdminJs.initUnitTour();YnTourAdminJs.showPopupManageTour()},editTour:function(a){$.ajax({type:"POST",url:site_url+"modules/?r=tour_guide/ajax_mode/get_tour_info",dataType:"json",data:"tour_id="+a,success:function(b){1==b.err?alert(b.msg_err):$("#yn_t_ad_tour_"+
a).hasClass("open")?YnTourAdminJs.refreshEditTour(b.tour_data,a,b.all_stations):YnTourAdminJs.beginEditTour(b.tour_data,a,b.all_stations)}})},refreshEditTour:function(a,b,c){$("#yn_t_ad_block_station, .yn_t_ad_block_add_station").slideUp("400",function(){$("#yn_t_ad_block_station, .yn_t_ad_block_add_station").remove();YNTAE.initTour(a,b,c)})},beginEditTour:function(a,b,c){$("#yn_t_ad_tour_"+b).addClass("open");$(".yn_t_ad_unit_tour:not(#yn_t_ad_tour_"+b+"), .yn_t_ad_block_add_tour, .yn_t_ad_form_add_tour").hide(500);
YNTAE.initTour(a,b,c)},finishEditTour:function(a){YNTAE.cSL();$(".yn_t_ad_tour_station_edit_preview").remove();$("#yn_t_ad_block_station, .yn_t_ad_block_add_station").slideUp("400",function(){$(".yn_t_ad_unit_tour:not(#yn_t_ad_tour_"+a+"), .yn_t_ad_block_add_tour").show();$("#yn_t_ad_tour_"+a).removeClass("open");$("#yn_t_ad_block_station, .yn_t_ad_block_add_station").remove()})},enableTour:function(a){$.ajax({type:"POST",url:site_url+"modules/?r=tour_guide/ajax_mode/enable_tour",dataType:"json",
data:"tour_id="+a,success:function(b){1==b.err?alert(b.msg_err):$("div#yn_t_ad_tour_"+a).find("img.yn_t_ad_img_enable").attr("src",b.img_active)}})},addNewTour:function(){var a=$("#yn_t_ad_f_add_tour_name").val(),b=$("input:radio[name=yn_t_ad_auto_play]:checked").val();$.ajax({type:"POST",url:site_url+"modules/?r=tour_guide/ajax_mode/add_tour",dataType:"json",data:"path_name="+(window.location.hostname+window.location.pathname)+"&tour_name="+a+"&auto_play="+b,success:function(a){1==a.err?alert(a.msg_err):
$("#yn_t_ad_form_add_tour").before($(a.unit_tour).hide()).slideUp(400,function(){YnTourAdminJs.initUnitTour();$("div.yn_t_ad_unit_tour:last").slideDown();$("#yn_t_ad_f_add_tour_name").val("")})}})},initUnitTour:function(){$("div.yn_t_ad_unit_tour").each(function(){var a=$(this),b=a.attr("id").replace("yn_t_ad_tour_","");a.find("img, .yn_t_ad_unit_title").tooltip({track:!0,extraClass:"info yn_tooltip",id:"yn_tooltip",showURL:!1});a.find("img.yn_t_ad_img_enable").bind("click",{tour_id:b},function(a){YnTourAdminJs.enableTour(a.data.tour_id)});
a.find("img.yn_t_ad_img_edit").bind("click",{tour_id:b},function(a){YnTourAdminJs.editTour(a.data.tour_id)});a.find("img.yn_t_ad_img_test").bind("click",{tour_id:b},function(a){$(".yn_t_ad_unit_station_edit.editing").length?alert("Please finish edit station before run test tour"):YnTourAdminJs.runTour(a.data.tour_id)})})},runTour:function(a){$.ajax({type:"POST",url:site_url+"modules/?r=tour_guide/ajax_mode/get_test_tour_data",dataType:"json",data:"tour_id="+a,success:function(a){1==a.err?alert(a.msg_err):
$.jTour(a.tour_data,YnTourAdminJs.beginRunTest,YnTourAdminJs.endRunTest)}})},beginRunTest:function(){$("#yn_t_ad_mana_tour").slideUp()},endRunTest:function(){$(".yn_tour_overlay").fadeTo(0,0.1,function(){$("#yn_t_ad_mana_tour").slideDown()})},showFormAddNewTour:function(){$("#yn_t_ad_form_add_tour").slideToggle()},showPopupManageTour:function(){$("body").append($('<div class="yn_tour_overlay"></div><div class="yn_tour_overlay_white"></div>'));$(".yn_tour_overlay").fadeTo(0,0.1,function(){var a=$("#yn_t_ad_mana_tour"),
b="innerWidth"in window?window.innerWidth:document.documentElement.offsetWidth,c=(("innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight)-a.height())/2-30,b=(b-a.width())/2;a.css({top:c+"px",left:b+"px"}).slideDown();$("#yn_t_ad_mana_tour>div.TransBox").draggable({handle:".boxFirstHeader, .corner, .top_side, .left_side, .right_side, .bottom_side"})})},closePopupManageTour:function(){$("#yn_tour_bt_done_edit_tour").length&&$("#yn_tour_bt_done_edit_tour").trigger("click");
$.scrollTo("body",200,{onAfter:function(){$("#yn_t_ad_mana_tour, .yn_tour_overlay, .yn_tour_overlay_white, #yn_tooltip").slideUp(500,function(){$(this).remove()})}})},disableFindSelector:function(a){a.preventDefault();a.stopPropagation();YnTourAdminJs.bActive=!1;document.getElementById("yn_tour_form_add_station").style.display="none";$(".yn_t_ad_mouse_active").removeClass("yn_t_ad_mouse_active");$(".border_active").removeClass("border_active")}};$(document).ready(function(){YnTourAdminJs.init()});